@page "/"
@using Models
@inject NavigationManager NavigationManager

<PageTitle>Game Catalog</PageTitle>

<h1>Game Catalog</h1>

<div class="row mb-4">
    <div class="col-sm-6">
        <button type="button" class="btn btn-primary" @onclick="CreateGame">New Game</button>
    </div>

</div>

@if (games is null)
{
    <p><em>Loading ... </em></p>
    
}
else
{
    <DeleteGame Game="@currentGame" onClose ="@OnDeleteModalClose">



    </DeleteGame>


<table class = "table table-striped table-bordered table-hover ">
    <thead class="table-dark">
        <th>Id</th>
        <th>Name</th>
        <th>Genre</th>
        <th>Price</th>
        <th> Relase Date</th>
        <th> Make changes</th>
    </thead>
<tbody>
    @foreach (var game in games) 
    {
        <tr>
            <td>@game.Id</td>
            <td>@game.Name</td>
            <td>@game.Genre</td>
            <td>@game.Price</td>
            <td>@game.ReleaseDate.ToString("MM/dd/yyyy")
            </td>
            <td>
                <button class="btn btn-primary" @onclick = "(()=> EditGame(game.Id))">
                   <svg xmlns="http://www.w3.org/2000/svg" width="1.5em" height="1.5em" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 20h4L18.5 9.5a2.828 2.828 0 1 0-4-4L4 16zm9.5-13.5l4 4m-.499 8.5a2 2 0 1 0 4 0a2 2 0 1 0-4 0m2-3.5V17m0 4v1.5m3.031-5.25l-1.299.75m-3.463 2l-1.3.75m0-3.5l1.3.75m3.463 2l1.3.75"></path></svg>
                    </button> 

                    <button class="btn btn-danger" data-bs-toggle ="modal"
                    data-bs-target="#deleteModal"
                     @onclick = "(()=> currentGame = game)">
                   <svg xmlns="http://www.w3.org/2000/svg" width="1.5em" height="1.5em" viewBox="0 0 24 24"><path fill="currentColor" d="M16 9v10H8V9zm-1.5-6h-5l-1 1H5v2h14V4h-3.5zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2z"/></svg>
                    </button>
            </td>
        </tr>
    }
</tbody>
</table>

}



@code {
    private Game[]? games;
    private Game? currentGame;
    protected override void OnInitialized()
    {
        games = GameClient.GetGames();
    }
    private void CreateGame()
    {
        NavigationManager.NavigateTo("/game");
    }

    private void EditGame(int id)
    {
        NavigationManager.NavigateTo ($"/game/{id}");
    }

    private void OnDeleteModalClose(bool accepted)
    {
        if (accepted)
        {
            GameClient.DeleteGame(currentGame!.Id);
            games = GameClient.GetGames();
        }
    }

}




